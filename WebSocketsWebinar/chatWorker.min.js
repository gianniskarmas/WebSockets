var allWebSockets=[],broadcast=function(a){allWebSockets.forEach(function(b){b.postMessage(JSON.stringify(a))})};onconnect=function(a){var b=a.ports[0];allWebSockets.push(b),b.postMessage(JSON.stringify({username:"user"+Math.floor(Math.random()*1e3),type:"addUser"})),b.onmessage=function(a){var b=JSON.parse(a.data);switch(b.type){case"updateUsername":broadcast({username:"System",type:"message",body:"Username changed to: "+b.username});break;case"message":broadcast({username:b.username,type:"message",body:b.body});break;case"slide":broadcast({lala:b.body,type:"slider"})}},wait()}